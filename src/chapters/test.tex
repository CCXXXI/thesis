\chapter{\app 的测试}\label{ch:test}


\section{项目的测试环境}\label{sec:test-env}

\subsection{测试的硬件环境}\label{subsec:test-hardware}

测试共使用了一台Windows电脑、一台macOS电脑、一部Android手机、一个动态心电记录仪。另有部分测试运行于GitHub提供的虚拟环境中，其硬件情况不确定。由于模型可以在CPU上运行，测试时没有显卡方面的需求。Windows电脑是ThinkBook 16 G4+ IAP型号，为主要的开发用设备，也顺便执行了多数测试。macOS电脑为Mac mini M2 Pro型号，用于运行iOS模拟器以进行iOS平台相关测试，；苹果不允许Windows或Linux系统运行其设备模拟器，虽然也有办法绕过限制，但较为不便。Android手机为Redmi Note 8 Pro型号，用于执行蓝牙相关测试，因为Android和iOS模拟器均不支持蓝牙。动态心电记录仪为数创医疗的HA301B型号，用于测试设备连接。GitHub Actions环境用于持续集成中自动执行测试。

\subsection{测试的软件环境}\label{subsec:test-software}

本地测试环境中，不需要移动设备的测试都在Windows电脑上进行，其系统版本为Windows 11专业版22H2，测试时使用最新的stable频道的Flutter SDK，最新的Python SDK等；另通过WSL2配置了Linux环境，安装了最新的GCC等工具。需要移动设备的测试多数在模拟器中进行，Android模拟器使用了Pixel 6 Pro API 33型号，iOS模拟器使用了iPhone 14 Pro Max型号；需要真实蓝牙连接的测试在Android手机上执行，为Android 11版本。持续集成环境中各种工具也均使用最新稳定版本。


\section{测试数据的来源}\label{sec:test-data}

测试使用的部分数据是继承至原算法项目的，包括输入数据和模型的预期输出结果。由于其数据量较大，且为异常心电数据，另外从公开数据库中下载了一些正常数据以供测试。具体而言，从PhysioNet下载了CEBSDB数据集\footnote{\url{https://physionet.org/content/cebsdb/1.0.0/}}，并提取了其中m001号数据的I、II导联的前10分钟数据，再重采样为125Hz并转换为项目中使用的JSON格式。进行重采样一方面是因为原始数据为5000Hz，文件过大；另一方便是因为HA301B型号心电设备的采样率为125Hz，对数据进行重采样后可以更贴近其情况。


\section{测试用例}\label{sec:test-case}

应用开发过程中，在编写功能代码的同时，也为其编写了许多对应的单元测试用例，本节简单记录这些测试用例的情况。另外，对应用也以演示形式进行了集成测试，但没有明确遵循固定步骤，故不在此列出。

\subsection{Flutter部分}\label{subsec:test-flutter}

Flutter部分的测试基于该框架自带的测试功能。其写法与主流测试库相近，主要差别在于对Flutter UI的测试有特别支持。在测试中，可以使用 @pumpWidget@ 方法只执行某一UI组件相关的代码，方便对各部分分别进行测试。其中的pump一词难以翻译，故以下描述中直接使用原文。

\subsubsection{冒烟测试}

这是最基本的一个测试用例。该用例在开发过程中有少数几次未通过的情况，基本都是类似提交了不完整的代码导致无法通过编译，或者持续集成环境配置出错等在实际运行前就报错的场景。该用例的通过可以确认项目的基本测试环境正常，而其失败则意味着其他用例的执行情况没有详细查看的意义。

\begin{enumerate}
    \item 进行必要的初始化，如数据库初始化等；基本与主函数相同，但数据库文件路径等使用测试用空路径，以模拟应用首次运行的情况。
    \item pump应用主体组件 @AppCore@。
    \item 断言屏幕上可以找到一个 @realTime@ 字符串（在中文环境下为 @实时心电@）。
\end{enumerate}


\section{测试结果分析}\label{sec:test-result}

\todo{测试结果分析}
